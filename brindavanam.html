<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brindavanam - IAIM Recital</title>
    <link rel="stylesheet" href="style.css?v=4">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600;700&family=Inter:wght@300;400;600&display=swap"
        rel="stylesheet">
    <style>
        .hidden {
            display: none !important;
        }

        /* Fallback if style.css fails */
    </style>
</head>

<body>

    <header>
        <div class="logo-container">
            <img src="logo.png" alt="IAIM Logo" class="logo" style="max-height: 50px;" onclick="location.reload()">
        </div>
        <h1 id="page-title">Brindavanam</h1>
    </header>

    <main id="app-container">
        <!-- Views -->

        <!-- List View -->
        <div id="view-list" class="view-container">
            <div class="list-group" id="song-list-container">
                <!-- Fallback content in case JS fails -->
                <p style="text-align:center; color:#999;">Loading songs...</p>
            </div>
        </div>

        <!-- Detail View -->
        <div id="view-detail" class="view-container hidden">
            <button class="btn-back" onclick="showList()"
                style="margin-bottom:15px; padding:8px 16px; cursor:pointer;">← Back to Songs</button>

            <h2 id="song-title-display" class="song-title"></h2>

            <div class="tabs" style="margin-bottom:20px;">
                <button class="tab-btn active" onclick="switchTab('videos')" style="margin-right:10px;">Videos</button>
                <button class="tab-btn" onclick="switchTab('lyrics')">Lyrics</button>
            </div>

            <div id="tab-content-videos" class="tab-content active">
                <div id="video-list-container" class="video-container"></div>
            </div>

            <div id="tab-content-lyrics" class="tab-content">
                <div id="lyrics-display" class="lyrics-box"
                    style="white-space: pre-wrap; background:#fff; padding:20px; border-radius:8px;"></div>
            </div>
        </div>

    </main>

    <script>
        // Global Error Handler for Debugging
        window.onerror = function (msg, url, line) {
            const container = document.getElementById('app-container');
            if (container) {
                container.innerHTML = '<div style="background:#fee; color:red; padding:20px; border:1px solid red; border-radius:8px; margin-top:20px;">' +
                    '<h3>Something went wrong</h3>' +
                    '<p>' + msg + '</p>' +
                    '<small>Line: ' + line + '</small>' +
                    '</div>';
            }
        };

        // --- DATA ---
        const CHOIR_DATA = {
            id: 'brindavanam',
            name: 'Brindavanam',
            subtitle: 'Older Kids',
            songs: [
                {
                    id: 'radhe-shyam',
                    title: 'Radhe Shyam',
                    lyrics: `Radhe shyama radhe Shyam
Radha Madhava radhe Shyam

Adi Narayana radhe Shyam 
Anadi  purusha Megha Shyam

Vasudeva Hari radhe Shyam 
Vasuki Shayana Megha Shyam ( radhe Shyam )

Shrisha Ramesh radhe Shyam 
Keshava Achutha Megha Shyam

Sesha Shayana Hari radhe Shyam
Dasaki shavanutha Megha Shyam ( radhe Shyam )`,
                    videos: [
                        { title: 'Learning Module', url: 'https://share.descript.com/embed/s83BqlbfQze' }
                    ]
                },
                {
                    id: 'narayana-suktam',
                    title: 'Narayana Suktam',
                    lyrics: `ṛtagṃ sa̠tya-mpa̍ra-mbra̠hma̠ pu̠ruṣa̍m-kṛṣṇa̠piṅga̍lam ।
ū̠rdhvarē̍taṃ vi̍rūpā̠kṣa̠ṃ vi̠śvarū̍pāya̠ vai namō̠ nama̍ḥ ॥
nnā̠rā̠ya̠ṇāya̍ vi̠dmahē̍ vāsudē̠vāya̍ dhīmahi ।
tannō̍ viṣṇuḥ prachō̠dayā̎t ॥`,
                    videos: [
                        { title: 'Learning Module 1', url: '' }
                    ]
                }
            ]
        };

        // --- LOGIC ---
        const viewList = document.getElementById('view-list');
        const viewDetail = document.getElementById('view-detail');
        const songListContainer = document.getElementById('song-list-container');
        const pageTitle = document.getElementById('page-title');

        const songTitleDisplay = document.getElementById('song-title-display');
        const videoListContainer = document.getElementById('video-list-container');
        const lyricsDisplay = document.getElementById('lyrics-display');

        // Tab Content Elements
        const tabContentVideos = document.getElementById('tab-content-videos');
        const tabContentLyrics = document.getElementById('tab-content-lyrics');

        function init() {
            console.log('Initializing Brindavanam...');
            renderList();
        }

        function renderList() {
            if (!songListContainer) return;
            songListContainer.innerHTML = '';
            CHOIR_DATA.songs.forEach(song => {
                const item = document.createElement('div');
                item.className = 'song-item';
                item.onclick = function () { showDetail(song); }; // explicit function reference
                item.innerHTML = '<span class="song-item-title">' + song.title + '</span>' +
                    '<span class="arrow-icon" style="color:#ccc;">›</span>';
                songListContainer.appendChild(item);
            });
        }

        function showList() {
            viewDetail.classList.add('hidden');
            viewList.classList.remove('hidden');
            pageTitle.textContent = CHOIR_DATA.name;
            window.scrollTo(0, 0);
        }

        function showDetail(song) {
            // Populate content
            songTitleDisplay.textContent = song.title;
            lyricsDisplay.textContent = song.lyrics || 'Lyrics coming soon...';

            // Videos
            videoListContainer.innerHTML = '';
            if (song.videos && song.videos.length > 0) {
                song.videos.forEach(video => {
                    let embedUrl = video.url;

                    if (!video.url) {
                        videoListContainer.innerHTML += '<div class="video-card"><p>Video coming soon...</p></div>';
                        return;
                    }

                    try {
                        if (video.url.includes('youtube.com/watch?v=')) {
                            embedUrl = 'https://www.youtube.com/embed/' + video.url.split('v=')[1].split('&')[0];
                        } else if (video.url.includes('youtu.be/')) {
                            embedUrl = 'https://www.youtube.com/embed/' + video.url.split('youtu.be/')[1].split('?')[0];
                        }
                    } catch (e) { console.error('Error parsing video URL', e); }

                    videoListContainer.innerHTML += '<div class="video-card" style="margin-bottom:20px;">' +
                        '<div class="video-header" style="font-weight:600; margin-bottom:5px;">' + video.title + '</div>' +
                        '<div class="video-wrapper" style="position:relative; padding-bottom:56.25%; height:0; overflow:hidden;">' +
                        '<iframe src="' + embedUrl + '" style="position:absolute; top:0; left:0; width:100%; height:100%; border:0;" allowfullscreen></iframe>' +
                        '</div></div>';
                });
            } else {
                videoListContainer.innerHTML = '<p style="text-align:center; color:#666;">No videos available yet.</p>';
            }

            // Switch view
            viewList.classList.add('hidden');
            viewDetail.classList.remove('hidden');
            pageTitle.textContent = song.title;

            // Reset tabs
            switchTab('videos');
            window.scrollTo(0, 0);
        }

        function switchTab(tabName) {
            // Update Buttons
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => btn.style.fontWeight = 'normal');

            // Update Content Visibility
            // Use .active class to control display (as per style.css)
            if (tabName === 'videos') {
                if (buttons[0]) buttons[0].style.fontWeight = 'bold';
                tabContentVideos.classList.add('active');
                tabContentLyrics.classList.remove('active');
            } else {
                if (buttons[1]) buttons[1].style.fontWeight = 'bold';
                tabContentVideos.classList.remove('active');
                tabContentLyrics.classList.add('active');
            }
        }

        // Init on load
        window.onload = init;

    </script>
</body>

</html>